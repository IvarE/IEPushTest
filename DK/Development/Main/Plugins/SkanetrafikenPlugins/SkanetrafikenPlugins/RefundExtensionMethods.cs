using System;
using Microsoft.Xrm.Sdk;
using CRM2013.SkanetrafikenPlugins.Common;


namespace CRM2013.SkanetrafikenPlugins
{
    public static class RefundExtensionMethods
    {
        #region Public Methods
        public static bool IsAutoGenerated(this Entity refund)
        {
            return refund.Contains("cgi_isautogenerated") && refund.GetAttributeValue<bool>("cgi_isautogenerated");
        }

        public static bool IsActive(this Entity refund)
        {

            return refund.Contains("statecode") && refund.GetAttributeValue<OptionSetValue>("statecode").Value == 0;
        }

        public static bool GiftCodeHasBeenUsed(this Entity refund)
        {
            //A used date field is present in CRM, but there is currently no functionality to fill it when a code is used
            var dateUsed = refund.GetValue<DateTime>("cgi_value_code_used");

            return dateUsed != default(DateTime);
        }

        public static bool GiftCodeHasExpired(this Entity refund)
        {
            var expiryDate = refund.GetValue<DateTime>("cgi_last_valid");

            if (expiryDate == default(DateTime)) //no date present, gift code cannot expire
            {
                return false;
            }
            return expiryDate < DateTime.Now;
        }

        public static string ValueCode(this Entity refund)
        {
            return refund.GetAttributeValue<string>("cgi_value_code");
        }
        #endregion
    }
}
