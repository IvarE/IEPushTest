


--
-- base view for cgi_refund
--
create view dbo.[cgi_refund]
 (
    -- logical attributes
    [CreatedByName],
    [CreatedByYomiName],
    [CreatedOnBehalfByName],
    [CreatedOnBehalfByYomiName],
    [ModifiedByName],
    [ModifiedByYomiName],
    [ModifiedOnBehalfByName],
    [ModifiedOnBehalfByYomiName],
    [cgi_ProductidName],
    [cgi_ContactidYomiName],
    [cgi_ContactidName],
    [cgi_ReimbursementFormidName],
    [cgi_responsibleIdName],
    [cgi_transportcompanyidName],
    [cgi_CaseidName],
    [cgi_RefundTypeidName],
    [TransactionCurrencyIdName],
    [cgi_AccountidName],
    [cgi_InvoiceRecipientName],

    -- ownership entries
    OwnerId,
    OwnerIdName,
    OwnerIdYomiName,
    OwnerIdDsc,
    OwnerIdType,
    OwningUser,
    OwningTeam,

    -- physical attributes
    [cgi_refundId],
    [CreatedOn],
    [CreatedBy],
    [ModifiedOn],
    [ModifiedBy],
    [CreatedOnBehalfBy],
    [ModifiedOnBehalfBy],
    [OwningBusinessUnit],
    [statecode],
    [statuscode],
    [VersionNumber],
    [ImportSequenceNumber],
    [OverriddenCreatedOn],
    [TimeZoneRuleVersionNumber],
    [UTCConversionTimeZoneCode],
    [cgi_refundnumber],
    [cgi_Amount],
    [TransactionCurrencyId],
    [ExchangeRate],
    [cgi_amount_Base],
    [cgi_AmountwithTAX],
    [cgi_amountwithtax_Base],
    [cgi_Attestation],
    [cgi_Quantity],
    [cgi_Reference],
    [cgi_ReInvoicing],
    [cgi_InvoiceRecipient],
    [cgi_Accountid],
    [cgi_Productid],
    [cgi_RefundTypeid],
    [cgi_ReimbursementFormid],
    [cgi_Caseid],
    [cgi_car_reg],
    [cgi_milage],
    [cgi_last_valid],
    [cgi_milage_compensation],
    [cgi_taxi_company],
    [cgi_transportcompanyid],
    [cgi_auth_approved],
    [cgi_amount_above_limit],
    [cgi_amount_above_limit_Base],
    [cgi_comments],
    [cgi_value_code],
    [cgi_travelcard_number],
    [cgi_Contactid],
    [cgi_responsibleId],
    [cgi_soc_sec_number],
    [cgi_iban],
    [cgi_swift],
    [cgi_accountno],
    [cgi_foreign_payment],
    [cgi_vat_code],
    [cgi_ExportedRaindance],
    [cgi_ExportMessage],
    [cgi_ExportDate],
    [cgi_checknumber],
    [cgi_attest_req],
    [cgi_IsAutoGenerated],
    [cgi_EHOrderNumber],
    [cgi_CustomerMessage],
    [cgi_amount_limit_warn],
    [cgi_amount_limit_warn_Base],
    [cgi_MobileNumber],
    [cgi_email],
    [cgi_errormessage],
    [cgi_mandcust],
    [cgi_calculated_compensation],
    [cgi_calculated_amount],
    [cgi_value_code_used],
    [cgi_invoiceexportdate],
    [cgi_invoiceexportedraindance],
    [cgi_invoiceexportmessage]
) with view_metadata as
select
    -- logical attributes
    [lk_cgi_refund_createdby].[FullName],
    [lk_cgi_refund_createdby].[YomiFullName],
    [lk_cgi_refund_createdonbehalfby].[FullName],
    [lk_cgi_refund_createdonbehalfby].[YomiFullName],
    [lk_cgi_refund_modifiedby].[FullName],
    [lk_cgi_refund_modifiedby].[YomiFullName],
    [lk_cgi_refund_modifiedonbehalfby].[FullName],
    [lk_cgi_refund_modifiedonbehalfby].[YomiFullName],
    [cgi_cgi_refundproduct_cgi_refund_Productid].[cgi_refundproductname],
    [cgi_contact_cgi_refund_Contactid].[YomiFullName],
    [cgi_contact_cgi_refund_Contactid].[FullName],
    [cgi_cgi_reimbursementform_cgi_refund_ReimbursementFormid].[cgi_reimbursementname],
    [cgi_refundresponsible_cgi_refund].[cgi_name],
    [cgi_transportcompany_refund].[cgi_name],
    [cgi_incident_cgi_refund_Caseid].[Title],
    [cgi_cgi_refundtype_cgi_refund_RefundTypeid].[cgi_refundtypename],
    [TransactionCurrency_cgi_refund].[CurrencyName],
    [cgi_cgi_refundaccount_cgi_refund_Accountid].[cgi_refundaccountname],
    [cgi_cgi_invoicerecipient_cgi_refund_InvoiceRecipient].[cgi_invoicerecipientname],

    -- ownership entries
    OwnerId = [cgi_refundBase].OwnerId,
    OwnerName = XXowner.Name,
    OwnerYomiName =  XXowner.YomiName,
    OwnerDsc = 0, -- DSC is removed, stub it to 0
    OwnerIdType = XXowner.OwnerIdType,
    OwningUser = case 
 		when XXowner.OwnerIdType= 8 then XXowner.OwnerId
		else null
		end,
    OwningTeam = case 
 		when XXowner.OwnerIdType= 9 then XXowner.OwnerId
		else null
		end,

    -- physical attribute
    [cgi_refundBase].[cgi_refundId],
    [cgi_refundBase].[CreatedOn],
    [cgi_refundBase].[CreatedBy],
    [cgi_refundBase].[ModifiedOn],
    [cgi_refundBase].[ModifiedBy],
    [cgi_refundBase].[CreatedOnBehalfBy],
    [cgi_refundBase].[ModifiedOnBehalfBy],
    [cgi_refundBase].[OwningBusinessUnit],
    [cgi_refundBase].[statecode],
    [cgi_refundBase].[statuscode],
    [cgi_refundBase].[VersionNumber],
    [cgi_refundBase].[ImportSequenceNumber],
    [cgi_refundBase].[OverriddenCreatedOn],
    [cgi_refundBase].[TimeZoneRuleVersionNumber],
    [cgi_refundBase].[UTCConversionTimeZoneCode],
    [cgi_refundBase].[cgi_refundnumber],
    [cgi_refundBase].[cgi_Amount],
    [cgi_refundBase].[TransactionCurrencyId],
    [cgi_refundBase].[ExchangeRate],
    [cgi_refundBase].[cgi_amount_Base],
    [cgi_refundBase].[cgi_AmountwithTAX],
    [cgi_refundBase].[cgi_amountwithtax_Base],
    [cgi_refundBase].[cgi_Attestation],
    [cgi_refundBase].[cgi_Quantity],
    [cgi_refundBase].[cgi_Reference],
    [cgi_refundBase].[cgi_ReInvoicing],
    [cgi_refundBase].[cgi_InvoiceRecipient],
    [cgi_refundBase].[cgi_Accountid],
    [cgi_refundBase].[cgi_Productid],
    [cgi_refundBase].[cgi_RefundTypeid],
    [cgi_refundBase].[cgi_ReimbursementFormid],
    [cgi_refundBase].[cgi_Caseid],
    [cgi_refundBase].[cgi_car_reg],
    [cgi_refundBase].[cgi_milage],
    [cgi_refundBase].[cgi_last_valid],
    [cgi_refundBase].[cgi_milage_compensation],
    [cgi_refundBase].[cgi_taxi_company],
    [cgi_refundBase].[cgi_transportcompanyid],
    [cgi_refundBase].[cgi_auth_approved],
    [cgi_refundBase].[cgi_amount_above_limit],
    [cgi_refundBase].[cgi_amount_above_limit_Base],
    [cgi_refundBase].[cgi_comments],
    [cgi_refundBase].[cgi_value_code],
    [cgi_refundBase].[cgi_travelcard_number],
    [cgi_refundBase].[cgi_Contactid],
    [cgi_refundBase].[cgi_responsibleId],
    [cgi_refundBase].[cgi_soc_sec_number],
    [cgi_refundBase].[cgi_iban],
    [cgi_refundBase].[cgi_swift],
    [cgi_refundBase].[cgi_accountno],
    [cgi_refundBase].[cgi_foreign_payment],
    [cgi_refundBase].[cgi_vat_code],
    [cgi_refundBase].[cgi_ExportedRaindance],
    [cgi_refundBase].[cgi_ExportMessage],
    [cgi_refundBase].[cgi_ExportDate],
    [cgi_refundBase].[cgi_checknumber],
    [cgi_refundBase].[cgi_attest_req],
    [cgi_refundBase].[cgi_IsAutoGenerated],
    [cgi_refundBase].[cgi_EHOrderNumber],
    [cgi_refundBase].[cgi_CustomerMessage],
    [cgi_refundBase].[cgi_amount_limit_warn],
    [cgi_refundBase].[cgi_amount_limit_warn_Base],
    [cgi_refundBase].[cgi_MobileNumber],
    [cgi_refundBase].[cgi_email],
    [cgi_refundBase].[cgi_errormessage],
    [cgi_refundBase].[cgi_mandcust],
    [cgi_refundBase].[cgi_calculated_compensation],
    [cgi_refundBase].[cgi_calculated_amount],
    [cgi_refundBase].[cgi_value_code_used],
    [cgi_refundBase].[cgi_invoiceexportdate],
    [cgi_refundBase].[cgi_invoiceexportedraindance],
    [cgi_refundBase].[cgi_invoiceexportmessage]
from [cgi_refundBase] 
    left join [cgi_invoicerecipientBase] [cgi_cgi_invoicerecipient_cgi_refund_InvoiceRecipient] on ([cgi_refundBase].[cgi_InvoiceRecipient] = [cgi_cgi_invoicerecipient_cgi_refund_InvoiceRecipient].[cgi_invoicerecipientId])
    left join [cgi_refundaccountBase] [cgi_cgi_refundaccount_cgi_refund_Accountid] on ([cgi_refundBase].[cgi_Accountid] = [cgi_cgi_refundaccount_cgi_refund_Accountid].[cgi_refundaccountId])
    left join [cgi_refundproductBase] [cgi_cgi_refundproduct_cgi_refund_Productid] on ([cgi_refundBase].[cgi_Productid] = [cgi_cgi_refundproduct_cgi_refund_Productid].[cgi_refundproductId])
    left join [cgi_refundtypeBase] [cgi_cgi_refundtype_cgi_refund_RefundTypeid] on ([cgi_refundBase].[cgi_RefundTypeid] = [cgi_cgi_refundtype_cgi_refund_RefundTypeid].[cgi_refundtypeId])
    left join [cgi_reimbursementformBase] [cgi_cgi_reimbursementform_cgi_refund_ReimbursementFormid] on ([cgi_refundBase].[cgi_ReimbursementFormid] = [cgi_cgi_reimbursementform_cgi_refund_ReimbursementFormid].[cgi_reimbursementformId])
    left join [ContactBase] [cgi_contact_cgi_refund_Contactid] on ([cgi_refundBase].[cgi_Contactid] = [cgi_contact_cgi_refund_Contactid].[ContactId])
    left join [IncidentBase] [cgi_incident_cgi_refund_Caseid] on ([cgi_refundBase].[cgi_Caseid] = [cgi_incident_cgi_refund_Caseid].[IncidentId])
    left join [cgi_refundresponsibleBase] [cgi_refundresponsible_cgi_refund] on ([cgi_refundBase].[cgi_responsibleId] = [cgi_refundresponsible_cgi_refund].[cgi_refundresponsibleId])
    left join [cgi_transportcompanyBase] [cgi_transportcompany_refund] on ([cgi_refundBase].[cgi_transportcompanyid] = [cgi_transportcompany_refund].[cgi_transportcompanyId])
    left join [SystemUserBase] [lk_cgi_refund_createdby] with(nolock) on ([cgi_refundBase].[CreatedBy] = [lk_cgi_refund_createdby].[SystemUserId])
    left join [SystemUserBase] [lk_cgi_refund_createdonbehalfby] with(nolock) on ([cgi_refundBase].[CreatedOnBehalfBy] = [lk_cgi_refund_createdonbehalfby].[SystemUserId])
    left join [SystemUserBase] [lk_cgi_refund_modifiedby] with(nolock) on ([cgi_refundBase].[ModifiedBy] = [lk_cgi_refund_modifiedby].[SystemUserId])
    left join [SystemUserBase] [lk_cgi_refund_modifiedonbehalfby] with(nolock) on ([cgi_refundBase].[ModifiedOnBehalfBy] = [lk_cgi_refund_modifiedonbehalfby].[SystemUserId])
    left join [TransactionCurrencyBase] [TransactionCurrency_cgi_refund] on ([cgi_refundBase].[TransactionCurrencyId] = [TransactionCurrency_cgi_refund].[TransactionCurrencyId])
    left join OwnerBase XXowner with(nolock) on ([cgi_refundBase].OwnerId = XXowner.OwnerId)
